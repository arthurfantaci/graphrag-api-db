<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2026-02-24T00:00:00.000Z" agent="GraphRAG Pipeline" etag="arch-v2" version="24.0.0" type="device" compressed="false">
  <diagram id="pipeline-architecture" name="Pipeline Architecture">
    <mxGraphModel dx="1100" dy="1350" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="1350" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <!-- Title -->
        <mxCell id="2" value="run_scraper() Pipeline" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="10" width="940" height="40" as="geometry"/>
        </mxCell>
        <!-- ═══════════════════════════════════════════════════════ -->
        <!-- Stage 1: SCRAPE (Blue)                                 -->
        <!-- ═══════════════════════════════════════════════════════ -->
        <mxCell id="10" value="Stage 1: SCRAPE" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;spacingTop=5;spacingLeft=12;fontSize=14;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;arcSize=6;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="60" width="940" height="185" as="geometry"/>
        </mxCell>
        <mxCell id="11" value="GuideScraper" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#6c8ebf;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="115" y="115" width="210" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="12" style="html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#6c8ebf;endArrow=block;endFill=1;" edge="1" source="11" target="13" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="13" value="Fetcher&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;(httpx / Playwright)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#6c8ebf;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="385" y="115" width="210" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="14" style="html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#6c8ebf;endArrow=block;endFill=1;" edge="1" source="13" target="15" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="15" value="HTMLParser" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#6c8ebf;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="655" y="115" width="210" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="16" value="Dynamic TOC discovery &#x2022; OG image enrichment &#x2022; Output: RequirementsManagementGuide" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="115" y="170" width="740" height="30" as="geometry"/>
        </mxCell>
        <!-- Flow Arrow: Stage 1 → Stage 2 -->
        <mxCell id="19" style="html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2.5;strokeColor=#333333;endArrow=block;endFill=1;" edge="1" source="10" target="20" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <!-- ═══════════════════════════════════════════════════════ -->
        <!-- Stage 2: EXTRACT &amp; EMBED (Green)                   -->
        <!-- ═══════════════════════════════════════════════════════ -->
        <mxCell id="20" value="Stage 2: EXTRACT &amp; EMBED (neo4j_graphrag SimpleKGPipeline)" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;spacingTop=5;spacingLeft=12;fontSize=14;fontStyle=1;fillColor=#d5e8d4;strokeColor=#82b366;arcSize=6;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="285" width="940" height="195" as="geometry"/>
        </mxCell>
        <mxCell id="21" value="GuideHTMLLoader" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#82b366;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="115" y="340" width="210" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="22" style="html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#82b366;endArrow=block;endFill=1;" edge="1" source="21" target="23" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="23" value="HierarchicalHTMLSplitter" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#82b366;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="385" y="340" width="210" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="24" style="html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#82b366;endArrow=block;endFill=1;" edge="1" source="23" target="25" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="25" value="LLMEntityRelExtractor" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#82b366;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="655" y="340" width="210" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="26" value="Gleaning (2-pass LLM) &#x2022; Schema: 12 nodes, 14 rels &#x2022; Voyage AI voyage-4 embeddings (1024d)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="115" y="400" width="740" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="27" value="OpenAI text-embedding-3-small fallback when VOYAGE_API_KEY not set" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#999999;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="115" y="425" width="740" height="20" as="geometry"/>
        </mxCell>
        <!-- Flow Arrow: Stage 2 → Stage 3 -->
        <mxCell id="29" style="html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2.5;strokeColor=#333333;endArrow=block;endFill=1;" edge="1" source="20" target="30" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <!-- ═══════════════════════════════════════════════════════ -->
        <!-- Stage 3: NORMALIZE — 3-Phase (Yellow/Orange)           -->
        <!-- ═══════════════════════════════════════════════════════ -->
        <mxCell id="30" value="Stage 3: NORMALIZE — 3-Phase Entity Post-Processing" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;spacingTop=5;spacingLeft=12;fontSize=14;fontStyle=1;fillColor=#fff2cc;strokeColor=#d6b656;arcSize=6;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="520" width="940" height="380" as="geometry"/>
        </mxCell>
        <!-- Phase A — Entity Creation -->
        <mxCell id="70" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9e6;strokeColor=#d6b656;strokeWidth=0.5;dashed=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="558" width="900" height="72" as="geometry"/>
        </mxCell>
        <mxCell id="71" value="Phase A — Entity Creation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=3;fontColor=#8B7500;" vertex="1" parent="1">
          <mxGeometry x="110" y="558" width="300" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="72" value="1. MentionedInBackfiller — MENTIONED_IN + APPLIES_TO" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="115" y="582" width="425" height="34" as="geometry"/>
        </mxCell>
        <mxCell id="73" value="2. LangExtractAugmenter — source grounding" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="555" y="582" width="425" height="34" as="geometry"/>
        </mxCell>
        <!-- Phase B — Entity Cleanup -->
        <mxCell id="74" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff6e0;strokeColor=#d6b656;strokeWidth=0.5;dashed=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="642" width="900" height="130" as="geometry"/>
        </mxCell>
        <mxCell id="75" value="Phase B — Entity Cleanup" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=3;fontColor=#8B7500;" vertex="1" parent="1">
          <mxGeometry x="110" y="642" width="300" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="76" value="3. EntityNormalizer — lowercase + trim" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="115" y="666" width="425" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="77" value="4. EntityNormalizer — deduplicate by name" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="115" y="700" width="425" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="78" value="5. EntityNormalizer — deduplicate cross-label" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="115" y="734" width="425" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="79" value="6. EntityCleanupNormalizer — generics + plurals" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="555" y="666" width="425" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="80" value="7. IndustryNormalizer — 100+ → 18 industries" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="555" y="700" width="425" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="81" value="8. EntitySummarizer — LLM entity descriptions" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="555" y="734" width="425" height="30" as="geometry"/>
        </mxCell>
        <!-- Phase C — Graph Analysis -->
        <mxCell id="82" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffedcc;strokeColor=#d6b656;strokeWidth=0.5;dashed=1;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="784" width="900" height="72" as="geometry"/>
        </mxCell>
        <mxCell id="83" value="Phase C — Graph Analysis" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=3;fontColor=#8B7500;" vertex="1" parent="1">
          <mxGeometry x="110" y="784" width="300" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="84" value="9. CommunityDetector — Leiden clustering" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="115" y="808" width="275" height="34" as="geometry"/>
        </mxCell>
        <mxCell id="85" value="10. CommunitySummarizer — LLM summaries" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="408" y="808" width="285" height="34" as="geometry"/>
        </mxCell>
        <mxCell id="86" value="11. CommunityEmbedder — community vectors" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffffff;strokeColor=#d6b656;align=left;spacingLeft=8;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="713" y="808" width="267" height="34" as="geometry"/>
        </mxCell>
        <mxCell id="87" value="Semantic rels only projected &#x2022; gpt-4o-mini for summaries &#x2022; Voyage AI voyage-4 for vectors" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="115" y="860" width="740" height="22" as="geometry"/>
        </mxCell>
        <!-- Flow Arrow: Stage 3 → Stage 4 -->
        <mxCell id="49" style="html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2.5;strokeColor=#333333;endArrow=block;endFill=1;" edge="1" source="30" target="50" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <!-- ═══════════════════════════════════════════════════════ -->
        <!-- Stage 4: SUPPLEMENT (Purple)                           -->
        <!-- ═══════════════════════════════════════════════════════ -->
        <mxCell id="50" value="Stage 4: SUPPLEMENT — Graph Structure" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;spacingTop=5;spacingLeft=12;fontSize=14;fontStyle=1;fillColor=#e1d5e7;strokeColor=#9673a6;arcSize=6;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="940" width="940" height="165" as="geometry"/>
        </mxCell>
        <mxCell id="51" value="&lt;b&gt;Chapter nodes&lt;/b&gt;&lt;br&gt;+ Article relationships" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#9673a6;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="115" y="995" width="265" height="54" as="geometry"/>
        </mxCell>
        <mxCell id="52" value="&lt;b&gt;Resource nodes&lt;/b&gt;&lt;br&gt;(Image, Video, Webinar)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#9673a6;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="410" y="995" width="265" height="54" as="geometry"/>
        </mxCell>
        <mxCell id="53" value="&lt;b&gt;Glossary structure&lt;/b&gt;&lt;br&gt;+ concept linking" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#9673a6;shadow=0;" vertex="1" parent="1">
          <mxGeometry x="705" y="995" width="265" height="54" as="geometry"/>
        </mxCell>
        <mxCell id="54" value="Community summary vector index (1024d cosine)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="115" y="1060" width="820" height="25" as="geometry"/>
        </mxCell>
        <!-- Flow Arrow: Stage 4 → Stage 5 -->
        <mxCell id="59" style="html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2.5;strokeColor=#333333;endArrow=block;endFill=1;" edge="1" source="50" target="60" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <!-- ═══════════════════════════════════════════════════════ -->
        <!-- Stage 5: VALIDATE (Red)                                -->
        <!-- ═══════════════════════════════════════════════════════ -->
        <mxCell id="60" value="Stage 5: VALIDATE (Optional)" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;spacingTop=5;spacingLeft=12;fontSize=14;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;arcSize=6;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="1145" width="940" height="140" as="geometry"/>
        </mxCell>
        <mxCell id="61" value="ValidationQueries" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#b85450;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="230" y="1200" width="250" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="62" style="html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1.5;strokeColor=#b85450;endArrow=block;endFill=1;" edge="1" source="61" target="63" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="63" value="ValidationReporter" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fillColor=#ffffff;strokeColor=#b85450;shadow=0;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="590" y="1200" width="250" height="44" as="geometry"/>
        </mxCell>
        <mxCell id="64" value="Orphan detection &#x2022; Entity quality &#x2022; Relationship patterns &#x2022; Auto-archived reports" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#666666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="115" y="1250" width="820" height="25" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
